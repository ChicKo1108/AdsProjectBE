# 数据库种子文件 (Database Seeds)

本目录包含了项目中所有数据表的种子文件，用于初始化测试数据。

## 文件说明

### 种子文件列表
- `01_user.js` - 用户表种子数据
- `02_account.js` - 账户表种子数据
- `03_ad_group.js` - 广告组表种子数据
- `04_ad_plan.js` - 广告计划表种子数据
- `05_ad_creatives.js` - 广告创意表种子数据
- `06_ad_plan_ad_group.js` - 广告计划与广告组关联表种子数据
- `07_user_account.js` - 用户与账户关联表种子数据

### 执行顺序
种子文件按照文件名前缀的数字顺序执行，确保外键依赖关系正确：
1. 用户表 (无依赖)
2. 账户表 (无依赖)
3. 广告组表 (依赖账户表)
4. 广告计划表 (无依赖)
5. 广告创意表 (无依赖)
6. 广告计划与广告组关联表 (依赖广告计划和广告组)
7. 用户与账户关联表 (依赖用户表和账户表)

## 使用方法

### 运行所有种子文件
```bash
npm run seed
```

### 创建新的种子文件
```bash
npm run seed:make seed_name
```

### 手动运行特定种子文件
```bash
knex seed:run --specific=01_users.js
```

## 测试数据说明

### 用户数据
- **superadmin** (super-admin): 系统超级管理员，密码: admin123
  - 可以访问、修改、删除所有account的账户信息以及plan/group/creatives
- **siteadmin1** (user): 账户管理员1，密码: 123456
  - 在移动应用推广账户和电商营销账户中拥有site_admin权限
- **operator1** (user): 广告操作员1，密码: 123456
  - 在移动应用推广账户和金融服务推广账户中拥有ad_operator权限
- **operator2** (user): 广告操作员2，密码: 123456
  - 在电商营销账户中拥有ad_operator权限，在金融服务推广账户中拥有site_admin权限
- **testuser** (user): 测试用户，密码: 123456
  - 在移动应用推广账户中拥有ad_operator权限但处于非激活状态

### 权限体系说明
1. **super-admin**: 整体系统的超级管理员
   - 可以访问、修改、删除所有account的账户信息以及plan/group/creatives
2. **site_admin**: 单个account中的账户管理员
   - 可以访问、修改所属account的账户信息以及plan/group/creatives
3. **ad_operator**: 单个account中的广告操作员
   - 可以访问所属account的账户信息以及plan/group/creatives

### 账户数据
- **移动应用推广账户** (ACC_MOBILE_001): 余额 10,000.00，今日消耗 150.50，日预算 500.00
- **电商营销账户** (ACC_ECOM_002): 余额 8,500.00，今日消耗 220.75，日预算 800.00
- **金融服务推广账户** (ACC_FIN_003): 余额 15,000.00，今日消耗 95.30，日预算 300.00

### 广告组数据
- 移动应用推广组 (账户1)
- 游戏推广组 (账户1)
- 电商推广组 (账户2)
- 教育推广组 (账户2)
- 金融推广组 (账户3)

### 广告计划数据
- 春季促销广告计划 (CPC, 进行中)
- 夏季游戏推广计划 (CPM, 进行中)
- 电商双11预热计划 (CPA, 暂停)

### 广告创意数据
- 春季促销横幅广告 (活跃)
- 游戏下载激励视频 (活跃)
- 电商产品展示广告 (暂停)
- 教育APP推广信息流 (活跃)
- 金融理财开屏广告 (活跃)

### 关联关系
- 春季促销计划 → 移动应用推广组 + 电商推广组
- 夏季游戏推广计划 → 游戏推广组 + 移动应用推广组
- 电商双11预热计划 → 电商推广组 + 金融推广组

### 用户权限关联
- siteadmin1: 管理移动应用推广账户和电商营销账户
- operator1: 操作移动应用推广账户和金融服务推广账户
- operator2: 操作电商营销账户，管理金融服务推广账户
- testuser: 在移动应用推广账户中有权限但未激活

## 注意事项

1. **数据清理**: 每个种子文件都会先清空对应表的数据
2. **外键约束**: 确保按照正确顺序执行，避免外键约束错误
3. **密码加密**: 用户密码使用bcrypt加密存储
4. **时间戳**: 所有记录都包含created_at和updated_at时间戳
5. **测试环境**: 这些数据仅用于开发和测试环境
6. **权限测试**: 包含多种权限组合，便于测试不同场景

## 开发建议

- 在开发新功能前运行种子文件，确保有足够的测试数据
- 修改种子数据时，考虑对现有测试用例的影响
- 生产环境不要运行这些种子文件
- 定期更新种子数据，保持与业务逻辑的一致性
- 使用不同权限的测试用户验证功能的权限控制